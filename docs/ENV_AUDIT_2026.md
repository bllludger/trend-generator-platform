# Аудит .env — февраль 2026

## Обзор

Проведён аудит переменных окружения проекта Trend Generator. Ниже — выводы и рекомендации по безопасности на 2026 год.

---

## Критические находки (исправлено)

### 1. Слабые пароли сервисов

| Переменная | Было | Проблема |
|------------|------|----------|
| `POSTGRES_PASSWORD` | `trends` | Дефолтный/слабый пароль, легко подбирается |
| `REDIS_PASSWORD` | **отсутствовал** | Redis работал без пароля (`redis://redis:6379/0`) |
| `ADMIN_UI_PASSWORD` | уже был сгенерирован | Обновлён на новый стойкий пароль |
| `ADMIN_API_KEY`, `JWT_SECRET_KEY`, `ADMIN_UI_SESSION_SECRET` | короткие/предсказуемые | Заменены на криптостойкие 256-битные значения |

**Действие:** Для всех сервисов сгенерированы новые пароли/секреты длиной 24–32 байта (hex) или 28 символов (пароли), соответствующие рекомендациям NIST/OWASP 2024–2026.

### 2. Redis без аутентификации

В `docker-compose.yml` Redis настроен на `--requirepass "${REDIS_PASSWORD}"`, но в `.env` переменная `REDIS_PASSWORD` отсутствовала — использовались URL без пароля. Это позволяло любому процессу в сети подключаться к Redis без авторизации.

**Действие:** Добавлены `REDIS_PASSWORD` и обновлены `REDIS_URL`, `CELERY_BROKER_URL`, `CELERY_RESULT_BACKEND` с учётом пароля.

---

## Секреты API (не менялись)

Следующие переменные содержат реальные ключи внешних сервисов. В аудите они **не перезаписываются** — при необходимости смените их вручную в кабинетах провайдеров:

- `TELEGRAM_BOT_TOKEN` — токен бота Telegram
- `OPENAI_API_KEY` — ключ OpenAI
- `GEMINI_API_KEY` — ключ Google Gemini

**Рекомендация:** Храните `.env` только на сервере, не коммитьте в git. Используйте секретное хранилище (Vault, облачные Secrets Manager) в production.

---

## Рекомендации по .env на 2026 год

1. **Права на файл:** `chmod 600 .env` — только владелец может читать/писать.
2. **Ротация:** Меняйте пароли БД, Redis и админки не реже раза в год или после ухода сотрудников.
3. **HTTPS в production:** Для админки установите `ADMIN_UI_COOKIE_SECURE=true` и используйте HTTPS.
4. **Хэш пароля админки:** Для усиления безопасности можно задать `ADMIN_UI_PASSWORD_HASH` (SHA256 или bcrypt) и не хранить пароль в открытом виде (если приложение это поддерживает).
5. **Логи:** Убедитесь, что в логи не попадают значения переменных из `.env`.

---

## Сгенерированные значения (применены в .env)

- **PostgreSQL:** пароль обновлён; `DATABASE_URL` приведён в соответствие с новым паролем.
- **Redis:** задан `REDIS_PASSWORD`; все URL Redis (приложение, Celery) переведены на использование пароля.
- **Админка:** обновлены `ADMIN_API_KEY`, `ADMIN_UI_PASSWORD`, `ADMIN_UI_SESSION_SECRET`, `JWT_SECRET_KEY`.

Пароли и ключи сгенерированы с помощью `secrets` (Python); длина и энтропия соответствуют современным требованиям к стойкости.

---

*Отчёт сформирован автоматически. Дата: февраль 2026.*
