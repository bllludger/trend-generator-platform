-- Обновить дефолтные промпты распознавания чека на формат JSON (amount_rub, card_number, date_time, comment).
-- Меняем только если в БД до сих пор старый дефолт (только сумма) из миграции 030.
UPDATE bank_transfer_settings
SET
    receipt_system_prompt = 'Ты — система распознавания банковских чеков и подтверждений переводов. Из изображения извлеки данные и верни ТОЛЬКО один валидный JSON-объект без markdown и пояснений.
Ключи JSON:
  amount_rub — сумма перевода в рублях (число или строка, например 150.00).
  card_number — номер карты получателя как на чеке (например 220424******5005).
  date_time — дата и время перевода в формате ДД.ММ.ГГГГ ЧЧ:ММ (например 12.02.2026 23:36).
  comment — текст комментария к переводу.
Если поля на изображении нет — укажи для него значение NOT_FOUND.
Пример ответа:
{"amount_rub": "150.00", "card_number": "220424******5005", "date_time": "12.02.2026 23:36", "comment": "оплата № 131"}',
    receipt_user_prompt = 'На изображении чек или подтверждение банковского перевода. Извлеки и верни в формате JSON: 1) сумму в рублях (число), 2) номер карты получателя как на чеке, 3) дату и время перевода (ДД.ММ.ГГГГ ЧЧ:ММ), 4) комментарий к переводу. Если поля нет — пиши NOT_FOUND для этого ключа.',
    updated_at = NOW()
WHERE id = 1
  AND (
    receipt_system_prompt = 'Ты — система распознавания банковских чеков и подтверждений переводов. Извлеки сумму перевода в рублях из изображения. Ответь ТОЛЬКО числом (рубли с копейками через точку, например 150.00). Если на изображении нет суммы перевода — ответь NOT_FOUND.'
    OR receipt_system_prompt LIKE 'Ты — система распознавания банковских чеков и подтверждений переводов. Из изображения извлеки следующие данные и верни каждое на отдельной строке:%'
    OR receipt_user_prompt = 'На изображении чек или подтверждение банковского перевода. Найди итоговую сумму перевода в рублях и верни ТОЛЬКО число. Примеры правильных ответов: 85.00, 150, 33.50. Если суммы нет — ответь NOT_FOUND.'
  );
