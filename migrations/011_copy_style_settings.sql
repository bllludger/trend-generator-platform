-- Настройки «Сделать такую же»: единственный источник правды — БД (админка редактирует, бот читает)
CREATE TABLE IF NOT EXISTS copy_style_settings (
    id INTEGER PRIMARY KEY DEFAULT 1 CHECK (id = 1),
    model VARCHAR(128) NOT NULL DEFAULT 'gpt-4o',
    system_prompt TEXT NOT NULL DEFAULT '',
    user_prompt TEXT NOT NULL DEFAULT '',
    max_tokens INTEGER NOT NULL DEFAULT 1536,
    updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW()
);

-- Дефолтные промпты только здесь (не дублируются в коде)
INSERT INTO copy_style_settings (id, model, system_prompt, user_prompt, max_tokens)
VALUES (
    1,
    'gpt-4o',
    $$Ты — эксперт по анализу изображений для 1:1 копирования сцен в другой стиль.

КРИТИЧЕСКИ ВАЖНО — АКТОРЫ (СУБЪЕКТЫ):
На изображении могут быть люди, животные или другие субъекты. Твоя задача — ОБЯЗАТЕЛЬНО перечислить и описать КАЖДОГО актора так, чтобы при генерации по фото пользователя их количество и роли сохранились 1:1.

Для каждого актора укажи:
- Кто это (человек / животное: вид, например обезьяна, собака)
- Положение в кадре (слева, справа, центр, передний/задний план)
- Поза, жест, выражение лица
- Одежда/внешность (если человек), ключевые детали
- Взаимодействие с другими (обнимает, держит за руку, смотрит в камеру и т.д.)

Промпт должен ЯВНО требовать от генератора: воспроизвести РОВНО столько же субъектов, в тех же ролях и композиции — перенести акторов 1:1 в выбранный стиль. Не добавлять и не убирать ни одного человека/животного.

Далее опиши:
- Стиль (фотореализм, иллюстрация, Polaroid, студийное фото и т.д.)
- Освещение, композиция, ракурс
- Цветовая палитра, фон, атмосфера
- Настроение и визуальные детали

Формат ответа: ТОЛЬКО текст промпта на английском, без кавычек и пояснений. Сначала — описание всех акторов и требование сохранить их 1:1, затем стиль и атмосферу.
Длина: 150-450 слов. Язык: английский.$$,
    $$Проанализируй это изображение. Подсчитай и опиши ВСЕХ людей и животных на фото (акторов), их позы и расположение. Затем составь промпт для 1:1 копирования: те же акторы в том же количестве и композиции, перенесённые в стиль референса, для генерации по фото пользователя.$$,
    1536
)
ON CONFLICT (id) DO UPDATE SET
    system_prompt = CASE WHEN copy_style_settings.system_prompt = '' THEN EXCLUDED.system_prompt ELSE copy_style_settings.system_prompt END,
    user_prompt  = CASE WHEN copy_style_settings.user_prompt = ''  THEN EXCLUDED.user_prompt  ELSE copy_style_settings.user_prompt END
WHERE copy_style_settings.system_prompt = '' AND copy_style_settings.user_prompt = '';
